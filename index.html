<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>Hit & Blow Game</title>
  <style>
    body {
      font-family: sans-serif;
      background: #f5f5f5;
      padding: 20px;
    }
    h1 { font-size: 1.5rem; }
    input {
      font-size: 1rem;
      padding: 5px;
      width: 120px;
    }
    button {
      font-size: 1rem;
      padding: 5px 10px;
      margin-left: 5px;
    }
    .log {
      margin-top: 20px;
      background: #fff;
      padding: 10px;
      border-radius: 6px;
    }
    .log div {
      border-bottom: 1px solid #ddd;
      padding: 4px 0;
    }
  </style>
</head>
<body>
  <h1>Hit & Blow</h1>
  <p>1〜9の異なる4桁の数字を入力してください</p>

  

  <input id="guess" maxlength="4" />
  <button onclick="submitGuess()">OK</button>

  <div class="log" id="log"></div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  function score(number) {
    number = (1 - number) * 100;
    if (number >= 97.5) return "unbelievable";
    if (number >= 80) return "excellent";
    if (number >= 60) return "great";
    if (number >= 20) return "good";
    return "bad";
  }

  function check(guess, answer) {
    let h = 0, b = 0;
    for (let i = 0; i < 4; i++) {
      if (guess[i] === answer[i]) h++;
      else if (answer.includes(guess[i])) b++;
    }
    return [h, b];
  }

  // 候補生成
  let original = [];
  for (let i = 1; i <= 9; i++) {
    for (let j = 1; j <= 9; j++) {
      if (j === i) continue;
      for (let k = 1; k <= 9; k++) {
        if (k === i || k === j) continue;
        for (let l = 1; l <= 9; l++) {
          if (l === i || l === j || l === k) continue;
          original.push(`${i}${j}${k}${l}`);
        }
      }
    }
  }

  let ans = original[Math.floor(Math.random() * original.length)];
  let choices = [...original];
  let history = [];
  let turn = 0;

  function updateChart() {
    const ctx = document.getElementById('chart').getContext('2d');
    if (window.myChart) window.myChart.destroy();
    window.myChart = new Chart(ctx, {
      type: 'line',
      data: {
        labels: history.map(h => h.turn),
        datasets: [{
          label: '候補削減率 (%)',
          data: history.map(h => h.percent),
          fill: false
        }]
      },
      options: { scales: { y: { min: 0, max: 100 } } }
    });
  }

  function submitGuess() {
    const input = document.getElementById("guess");
    const a = input.value;

    if (!original.includes(a)) {
      alert("正しい形式で入力してください");
      return;
    }

    const [hit, blow] = check(a, ans);

    const l = choices.length;
    let newChoices = [];
    for (let c of choices) {
      const [h, b] = check(c, a);
      if (h === hit && b === blow) newChoices.push(c);
    }
    const lNew = newChoices.length;
    choices = newChoices;

    turn++;
    const percent = (1 - lNew / l) * 100;
    history.push({ turn: turn, percent: percent });

    const div = document.createElement("div");
    div.textContent = `${a} | HIT:${hit} BLOW:${blow}`;
    document.getElementById("log").prepend(div);

    

    if (a === ans) {
      updateChart();
      alert("正解！");
    }("正解！");
    input.value = "";
  }
</script>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <canvas id="chart" width="400" height="200"></canvas>
</body>
</html>
